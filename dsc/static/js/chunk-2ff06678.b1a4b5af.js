(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2ff06678"],{"0492":function(e,t,s){},"15ce":function(e,t,s){"use strict";s("0492")},"32b3":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"box"},[s("page-frame",{attrs:{title:"审批策略",icon:"approvalStrategy"},scopedSlots:e._u([{key:"headBtn",fn:function(){return[s("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.showNewStrategy,expression:"!showNewStrategy"}],attrs:{type:"primary",size:"small",icon:"el-icon-plus"},on:{click:e.newStrategy}},[e._v(" 新建策略 ")])]},proxy:!0}])},[e.showNewStrategy?s("div",{staticClass:"newOrEditWrap"},[s("div",{staticClass:"header"},[s("div",{staticClass:"title"},[e._v(e._s(e.newOrEditTitle))]),s("div",{staticClass:"goBack",on:{click:function(t){e.showNewStrategy=!1}}},[s("i",{staticClass:"el-icon-back"}),s("span",[e._v("返回上一级")])])]),s("div",{staticClass:"content"},[s("el-form",{ref:"form",attrs:{"label-width":"100px","label-position":"right",size:"small"}},[s("el-form-item",{attrs:{label:"策略名称"}},[s("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入策略名称"},on:{blur:e.strategyNameExists},model:{value:e.formObj.strategyName,callback:function(t){e.$set(e.formObj,"strategyName",t)},expression:"formObj.strategyName"}})],1),s("el-form-item",{attrs:{label:"应用范围"}},[s("scope-select",{attrs:{setPath:e.setPath,size:"small",width:"300px"},on:{fullPath:e.fullPath},model:{value:e.showScope,callback:function(t){e.showScope=t},expression:"showScope"}})],1),s("el-form-item",{attrs:{label:"审批人"}},[s("div",{staticClass:"approval"},e._l(e.formObj.approvalList,(function(t,a){return s("div",{key:a,staticClass:"approvalWrap"},[1==t.type?s("div",{staticClass:"superior",on:{mouseenter:function(s){return e.setShowEdit(t)},mouseleave:function(s){return e.setHideEdit(t)}}},[t.showEdit?s("div",{staticClass:"EditWrap"},[s("span",{staticClass:"edit",on:{click:function(s){return e.editApproval(t,a)}}},[e._v(" 编辑 ")]),s("span",{staticClass:"del",on:{click:function(t){return e.delApproval(a,1)}}},[e._v(" 删除 ")])]):e._e(),s("div",{staticClass:"approvalBox"},[s("div",{staticClass:"iconBox"},[s("i",{staticClass:"iconfont icon-yonghutianchong"})]),s("span",[e._v(e._s(e.levelObj[t.superior.level]))]),s("span",[e._v(" （"+e._s(e.approvalMode[t.superior.approvalType])+"） ")])])]):e._e(),2==t.type?s("div",{staticClass:"member"},[s("div",{staticClass:"memberWrap",on:{mouseenter:function(s){return e.setShowEdit(t)},mouseleave:function(s){return e.setHideEdit(t)}}},[t.showEdit?s("div",{staticClass:"EditWrap"},[s("span",{staticClass:"edit",on:{click:function(s){return e.editApproval(t,a)}}},[e._v(" 编辑 ")]),s("span",{staticClass:"del",on:{click:function(t){return e.delApproval(a,2)}}},[e._v(" 删除 ")])]):e._e(),e._l(t.member.userList,(function(a,i){return s("div",{key:a.index,staticClass:"content"},[s("div",{staticClass:"memberBox"},[s("div",{staticClass:"iconBox"},[s("i",{staticClass:"iconfont icon-yonghutianchong"})]),s("span",[e._v(e._s(a.userId))])]),i!=t.member.userList.length-1?s("div",{staticClass:"interval"}):e._e()])}))],2),s("div",{staticClass:"memType"},[e._v(" （"+e._s(e.approvalMode[t.member.approvalType])+"） ")])]):e._e(),3==t.type?s("div",{staticClass:"iAm"},[s("div",{staticClass:"approvalBox"},[s("div",{staticClass:"iconBox"},[s("i",{staticClass:"iconfont icon-yonghutianchong"})]),s("span",[e._v("申请人本人")])])]):e._e()])})),0),s("div",{staticClass:"addBox",on:{click:e.clickAddBox}},[s("i",{staticClass:"el-icon-plus"})])])],1)],1),s("div",{staticClass:"footer"},[s("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.saveNewOrEdit}},[e._v(" 保存 ")]),s("el-button",{attrs:{type:"info",size:"small"},on:{click:e.cancelCreate}},[e._v(" 取消 ")])],1)]):s("div",{staticClass:"strategyWrap"},[s("div",{staticClass:"tips"},[e._v("提示：优先匹配排序靠前的审批流程")]),e.loading?s("div",{staticStyle:{"margin-top":"15px"}},[s("el-skeleton",{attrs:{rows:e.rows,variant:"rect",animated:""}})],1):s("strategy-item",{attrs:{strategyList:e.strategyList},on:{passSignal:e.passSignal,operation:e.operation}})],1)]),s("new-approval",{attrs:{formObj:e.approvalObj1,editOrNew:e.editOrNew},on:{addApproval:e.addApproval},model:{value:e.showNewApproval,callback:function(t){e.showNewApproval=t},expression:"showNewApproval"}}),s("new-cc",{on:{selectUser:e.selectUser},model:{value:e.showNewCc,callback:function(t){e.showNewCc=t},expression:"showNewCc"}})],1)},i=[],o=(s("d3b7"),s("d81d"),s("b0c0"),s("ac1f"),s("1276"),s("a434"),s("75ba")),l=s("be2c"),r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"box"},[s("el-dialog",{attrs:{visible:e.tempVal,width:"550px"},on:{"update:visible":function(t){e.tempVal=t},close:e.dialogClose}},[s("template",{slot:"title"},[s("div",{staticStyle:{height:"20px","line-height":"20px","border-left":"4px solid #1890ff","padding-left":"10px"}},[e._v(" 添加审批人 ")])]),s("el-radio-group",{on:{change:e.typeChange},model:{value:e.formObj.type,callback:function(t){e.$set(e.formObj,"type",t)},expression:"formObj.type"}},e._l(e.approvalType,(function(t){return s("el-radio",{key:t.value,attrs:{label:t.value}},[e._v(" "+e._s(t.label)+" ")])})),1),s("el-divider"),1==e.formObj.type?s("div",{staticClass:"superior"},[s("div",{staticClass:"level"},[s("div",{staticClass:"label"},[e._v("指定层级")]),s("el-select",{staticStyle:{"margin-right":"10px"},attrs:{size:"small"},model:{value:e.formObj.superior.levelType,callback:function(t){e.$set(e.formObj.superior,"levelType",t)},expression:"formObj.superior.levelType"}},e._l(e.levelTypes,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),s("el-select",{attrs:{size:"small"},model:{value:e.formObj.superior.level,callback:function(t){e.$set(e.formObj.superior,"level",t)},expression:"formObj.superior.level"}},e._l(e.levelList,(function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),s("div",{staticClass:"noLevel"},[s("div",{staticClass:"label"},[e._v("当前层级无上级时")]),s("el-checkbox",{model:{value:e.formObj.superior.noSuperior,callback:function(t){e.$set(e.formObj.superior,"noSuperior",t)},expression:"formObj.superior.noSuperior"}},[e._v(" 当前层级无上级时，此审批节点为空，直接跳过由上一级审批 ")])],1)]):e._e(),2==e.formObj.type?s("div",{staticClass:"member"},[s("div",{staticClass:"labelWrap"},[s("span",{staticClass:"label"},[e._v("添加成员")]),s("span",{staticClass:"tips"},[e._v("不能超过100人")])]),s("div",{staticClass:"memberWrap"},[e.formObj.member.userList.length>0?s("div",{staticClass:"content"},[e._l(e.formObj.member.userList,(function(t){return[s("div",{key:t.index,staticClass:"memberBox"},[s("div",{staticClass:"iconBox"},[s("i",{staticClass:"iconfont icon-yonghutianchong"})]),s("span",[e._v(e._s(t.userId))])])]}))],2):e._e(),s("div",{staticClass:"addBox",on:{click:e.addUser}},[s("i",{staticClass:"el-icon-plus"})])])]):e._e(),3!=e.formObj.type?s("el-divider"):e._e(),s("div",{staticClass:"label"},[e._v(" "+e._s(2==e.formObj.type?"多人审批模式":1==e.formObj.type?"同时有多个上级时":"")+" ")]),3!=e.formObj.type?s("el-radio-group",{staticStyle:{width:"150px"},model:{value:e.formObj[e.type].approvalType,callback:function(t){e.$set(e.formObj[e.type],"approvalType",t)},expression:"formObj[type].approvalType"}},e._l(e.approvalMode,(function(t){return s("el-radio",{key:t.value,staticStyle:{margin:"5px 0px"},attrs:{label:t.value,disabled:1==e.formObj.type&&3==t.value}},[e._v(" "+e._s(t.label)+" ")])})),1):e._e(),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"small"},on:{click:e.cancel}},[e._v("取 消")]),s("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.confirm}},[e._v(" 确 定 ")])],1)],2),s("new-cc",{attrs:{userList:e.userList},on:{selectUser:e.selectUser},model:{value:e.showAddMember,callback:function(t){e.showAddMember=t},expression:"showAddMember"}})],1)},n=[],p=(s("a9e3"),s("005f")),c=s("b8f0"),u={name:"newApproval",props:{value:Boolean,formObj:Object,editOrNew:Number},components:{newCc:p["a"]},data:function(){return{userList:[],type:"superior",showAddMember:!1,tempVal:!1,approvalType:[{label:"指定上级",value:1},{label:"指定成员",value:2},{label:"申请人本人",value:3}],approvalMode:[{label:"会签（须所有成员同意）",value:1},{label:"或签（一名成员同意即可）",value:2},{label:"依次审批（按顺序依次审批）",value:3}],levelTypes:[{label:"从下到上",value:1},{label:"从上到下",value:2}],levelList:[{label:"直接上级",value:1},{label:"第二级上级",value:2},{label:"第三级上级",value:3},{label:"第四级上级",value:4},{label:"第五级上级",value:5},{label:"第六级上级",value:6}]}},watch:{value:{handler:function(e){this.tempVal=e},immediate:!0},"formObj.type":function(e){this.type=1==e?"superior":"member"}},methods:{selectUser:function(e){this.formObj.member.userList=e.map((function(e,t){return{userId:e,index:t}}))},addUser:function(){this.userList=this.formObj.member.userList.map((function(e){return e.userId})),this.showAddMember=!0},typeChange:function(e){this.type=1==e?"superior":"member"},cancel:function(){this.$emit("input",!1)},confirm:function(){this.$emit("input",!1),this.$emit("addApproval",Object(c["a"])(this.formObj),this.editOrNew)},dialogClose:function(){this.$emit("input",!1)}}},v=u,d=(s("15ce"),s("2877")),m=Object(d["a"])(v,r,n,!1,null,"2543e24a",null),b=m.exports,h=s("cb40"),f={name:"approvalStrategy",components:{pageFrame:o["a"],strategyItem:l["a"],newApproval:b,newCc:p["a"],scopeSelect:h["a"]},data:function(){return{setPath:"",editIndex:-1,showEdit:!0,rows:14,showScope:"",loading:!1,isCreate:!1,showNewStrategy:!1,showNewApproval:!1,showNewCc:!1,newOrEditTitle:"",approvalMode:{1:"会签",2:"或签",3:"依次审批"},levelObj:{1:"直接上级",2:"第二级上级",3:"第三级上级",4:"第四级上级",5:"第五级上级",6:"第六级上级"},approvalObj:{superior:{levelType:1,level:1,noSuperior:!1,approvalType:1},member:{approvalType:1,userList:[]},type:1},approvalObj1:{},formObj:{id:null,scope:"",strategyName:"",strategyType:1,ccList:[],approvalList:[{superior:{levelType:1,level:1,noSuperior:!1,approvalType:1},member:{approvalType:1,userList:[]},type:1}]},strategyList:[],nameUsed:!1,editOrNew:0}},mounted:function(){this.rows=Math.round((document.body.offsetHeight-150)/38),this.getData()},methods:{getData:function(){var e=this;this.loading=!0,this.$http("getApprovalStrategyList").then((function(t){e.strategyList=t.data})).finally((function(){e.loading=!1}))},fullPath:function(e){this.formObj.scope=e},selectUser:function(e){this.formObj.ccList=e.map((function(e){return e.name}))},strategyNameExists:function(){var e=this;this.formObj.strategyName&&this.$http("strategyNameExists",{id:this.formObj.id,strategyName:this.formObj.strategyName}).then((function(t){t.data?(e.$message.warning("该策略名称已存在"),e.nameUsed=!0):e.nameUsed=!1}))},newStrategy:function(){this.newOrEditTitle="新建策略",this.approvalObj1=Object(c["a"])(this.approvalObj),this.isCreate=!0,this.showScope="",this.formObj.strategyType=1,this.formObj.scope="",this.formObj.strategyName="",this.formObj.ccList=[],this.formObj.approvalList=[],this.formObj.id=null,this.showNewStrategy=!0},passSignal:function(e,t){console.log("passSignal",t),this.isCreate=!1,this.setPath=t.scope,this.showNewStrategy=e,this.showScope=t.scope.split(",")[0].substring(3),this.newOrEditTitle="编辑策略",t["strategyType"]=1,this.formObj=Object(c["a"])(t)},operation:function(e){e&&this.getData()},addApproval:function(e,t){console.log(e),2==t?this.formObj.approvalList.push(e):1==e.type?(this.$set(this.formObj.approvalList[this.editIndex].superior,"levelType",e.superior.levelType),this.$set(this.formObj.approvalList[this.editIndex].superior,"level",e.superior.level),this.$set(this.formObj.approvalList[this.editIndex].superior,"noSuperior",e.superior.noSuperior),this.$set(this.formObj.approvalList[this.editIndex].superior,"approvalType",e.superior.approvalType)):(this.$set(this.formObj.approvalList[this.editIndex].member,"approvalType",e.member.approvalType),this.$set(this.formObj.approvalList[this.editIndex].member,"userList",e.member.userList))},saveNewOrEdit:function(){var e=this;if(this.nameUsed)this.$message.warning("该策略名称已存在");else{var t=this.isCreate?"createStrategy":"updateStrategy";console.log(t,this.formObj),this.$http(t,this.formObj).then((function(t){e.$message.success(t.errMsg)})).finally((function(){e.showNewStrategy=!1,e.getData()}))}},cancelCreate:function(){this.showNewStrategy=!1,this.getData()},setShowEdit:function(e){this.$set(e,"showEdit",!0)},setHideEdit:function(e){this.$set(e,"showEdit",!1)},delApproval:function(e){this.formObj.approvalList.splice(e,1)},editApproval:function(e,t){2==e.type?e.superior={levelType:1,level:1,noSuperior:!1,approvalType:1}:e.member={userList:[],approvalType:1},this.editIndex=t,this.editOrNew=1,this.approvalObj1=Object(c["a"])(e),this.showNewApproval=!0},clickAddBox:function(){this.approvalObj1=Object(c["a"])(this.approvalObj),this.showNewApproval=!0,this.editOrNew=2}}},y=f,w=(s("4fb3"),Object(d["a"])(y,a,i,!1,null,"5c67fbcd",null));t["default"]=w.exports},"46bb":function(e,t,s){},"4fb3":function(e,t,s){"use strict";s("46bb")}}]);